import { useState } from "react";

import styles from "./MainPage.module.css";

import { Web3Button } from "@web3modal/react";
import FileInput from "./file-upload/FileInput";
import DisplaySVG from "./file-upload/DisplaySvg";

import {
  useDisconnect,
  usePrepareContractWrite,
  useContractWrite,
} from "wagmi";
import createSvgNftAbi from "../assets/contract-abi/create-svg-abi.json";

import gorillaHead from "../assets/images/gorilla-head.svg";
import sadCat from "../assets/images/sad_cat_in_shower.svg";

export default function MainPage() {
  const [svgFile, setSvgFile] = useState(null);

  const handleFileChange = (file) => {
    setSvgFile(file);
  };

  /* Preparing the contract to write */
  //Contract Address for create-svg-nft
  const contractAddress = process.env.REACT_APP_CONTRACT_ADDRESS;

  //assigning the svg
  const svg = `<?xml version="1.0" encoding="UTF-8"?>
  <svg version="1.1" viewBox="0 0 784 784" xmlns="http://www.w3.org/2000/svg">
  <defs>
  <clipPath id="e">
  <path d="m0 588h588v-588h-588z"/>
  </clipPath>
  <clipPath id="d">
  <path d="m534.76 54.965 0.138 2e-3 -8e-3 0.33c-0.042-0.113-0.088-0.221-0.13-0.332"/>
  </clipPath>
  <clipPath id="c">
  <path d="m535.08 55.65h0.416v-0.416h-0.416z"/>
  </clipPath>
  <clipPath id="b">
  <path d="m535.08 55.65h0.13908v-0.33208h-0.13908z"/>
  </clipPath>
  <linearGradient id="a" x2="1" gradientTransform="matrix(.1388 0 0 -.1388 535.08 55.483)" gradientUnits="userSpaceOnUse">
  <stop stop-color="#fff" offset="0"/>
  <stop stop-color="#231f20" offset="1"/>
  </linearGradient>
  </defs>
  <g transform="matrix(1.3333 0 0 -1.3333 0 784)">
  <g clip-path="url(#e)">
  <g transform="translate(321.18 250.16)">
  <path d="m0 0s15.583-19.179 14.385-22.775c-5.993 5.993-14.385 11.987-14.385 11.987l-17.979-25.173s-11.987 3.597-10.789 17.981zm-37.177-17.98c1.198-14.384-10.788-17.981-10.788-17.981l-17.98 25.173s-8.391-5.994-14.384-11.987c-1.199 3.596 14.384 22.775 14.384 22.775zm121.63 71.697c-1.067-4.381-2.812-8.55-5.144-12.204-2.356-3.645-5.177-6.834-8.39-9.368-6.354-5.108-13.945-7.964-21.305-8.172 5.943 4.273 10.412 9.549 13.157 15.128 2.726 5.602 3.607 11.3 2.886 16.477-0.4 2.589-1.03 5.202-2.033 7.254-1.013 2.067-2.208 3.722-3.663 5.053-1.439 1.337-3.089 2.44-5.032 3.373-1.911 0.963-4.14 1.707-6.511 2.336-4.798 1.191-10.296 1.719-15.826 1.572-1.381-0.021-2.767-0.109-4.141-0.22l-5.211-0.325c-3.509-0.224-7.016-0.401-10.525-0.566-6.642-0.314-13.283-0.546-19.925-0.707v-4.424c0-2.637-2.158-4.795-4.795-4.795h-34.762c-2.636 0-4.794 2.158-4.794 4.795v4.45c-6.642 0.167-13.284 0.402-19.925 0.721-3.509 0.157-7.017 0.351-10.525 0.57l-5.211 0.331c-1.376 0.109-2.762 0.197-4.144 0.217-5.537 0.159-11.037-0.379-15.844-1.568-4.798-1.255-8.738-3.065-11.567-5.73-1.462-1.337-2.652-3-3.669-5.073-1.002-2.058-1.629-4.675-2.03-7.268-0.712-5.187 0.176-10.891 2.911-16.492 2.753-5.579 7.233-10.849 13.179-15.109-7.354 0.221-14.937 3.083-21.282 8.192-3.207 2.535-6.027 5.72-8.375 9.364-2.334 3.649-4.068 7.817-5.133 12.193-0.978 4.388-1.459 8.86-0.986 13.675 0.257 2.392 0.662 4.832 1.413 7.235 0.318 1.217 0.804 2.389 1.238 3.587 0.517 1.155 1.011 2.349 1.636 3.459 1.175 2.286 2.624 4.393 4.188 6.399 1.597 1.951 3.318 3.797 5.149 5.435 3.677 3.278 7.672 5.889 11.76 7.973 8.188 4.155 16.634 6.37 25.08 7.509 2.117 0.277 4.24 0.461 6.372 0.6l5.315 0.337c3.508 0.219 7.016 0.412 10.525 0.57 6.641 0.318 13.283 0.554 19.925 0.72v-3.94c0-2.637 2.158-4.795 4.794-4.795h34.762c2.637 0 4.795 2.158 4.795 4.795v3.967c6.642-0.162 13.283-0.393 19.925-0.707 3.509-0.166 7.016-0.343 10.525-0.566l5.315-0.332c2.132-0.139 4.258-0.324 6.375-0.602 8.452-1.127 16.902-3.353 25.098-7.505 4.09-2.088 8.092-4.698 11.773-7.979 1.834-1.639 3.555-3.489 5.154-5.443 1.567-2.007 3.02-4.115 4.193-6.407 2.451-4.51 3.807-9.526 4.293-14.299 0.472-4.823-0.011-9.298-0.988-13.691m-74.882 6.218c0 2.642 2.151 4.792 4.795 4.792 2.645 0 4.795-2.15 4.795-4.792 0-2.645-2.15-4.795-4.795-4.795-2.644 0-4.795 2.15-4.795 4.795m-28.527-19.18c0-1.458-1.181-2.639-2.638-2.639h-16.781c-1.458 0-2.639 1.181-2.639 2.639 0 1.457 1.181 2.638 2.639 2.638h16.781c1.457 0 2.638-1.181 2.638-2.638m-26.612 7.192c-1.986 0-3.596 1.61-3.596 3.596 0 1.985 1.61 3.597 3.596 3.597h31.166c1.986 0 3.596-1.612 3.596-3.597 0-1.986-1.61-3.596-3.596-3.596zm-35.96 11.988c0 2.642 2.151 4.792 4.795 4.792s4.795-2.15 4.795-4.792c0-2.645-2.151-4.795-4.795-4.795s-4.795 2.15-4.795 4.795m133.05-146.24h-172.61c-4.209 0 20.342 41.866 30.015 49.237-2.355 4.461-3.644 9.273-3.644 14.293 0 23.171 27.37 41.954 61.132 41.954 33.763 0 61.133-18.783 61.133-41.954 0-4.694-1.141-9.202-3.212-13.415 4.11-3.609 31.621-50.115 27.185-50.115m-23.973-51.543h-122.26c-7.252 0-13.186 5.934-13.186 13.186s5.934 13.184 13.186 13.184h122.26c7.252 0 13.185-5.932 13.185-13.184s-5.933-13.186-13.185-13.186m-167.09 303.68 0.148 2.54c0.06 0.847 0.223 1.681 0.333 2.525 0.191 1.697 0.655 3.336 1.006 5.01 0.935 3.272 2.006 6.553 3.537 9.619 2.93 6.215 7.091 11.764 11.735 16.777 4.659 5.031 10.066 9.275 15.719 13.063 5.67 3.78 11.689 7.009 17.938 9.664 6.239 2.681 12.67 4.878 19.212 6.641 13.1 3.487 26.639 5.121 40.152 5.187 6.759-0.014 13.519-0.409 20.237-1.213 6.711-0.844 13.383-2.06 19.942-3.767 13.093-3.424 25.849-8.593 37.238-16.102 5.678-3.751 11.099-7.969 15.831-12.921 4.692-4.973 8.862-10.505 11.918-16.648 2.972-6.166 4.978-12.844 5.285-19.629 0.181-3.377 0.041-6.759-0.505-10.06-0.572-3.296-1.457-6.517-2.707-9.57 3.046 12.887 0.54 26.331-6.199 36.989-6.628 10.793-16.625 19.126-27.551 25.471-11.02 6.292-23.074 10.768-35.489 13.639-6.21 1.437-12.509 2.519-18.857 3.19-6.342 0.711-12.732 1.049-19.122 1.035-12.781-0.017-25.551-1.464-37.96-4.38-12.424-2.867-24.421-7.502-35.404-13.842-5.476-3.195-10.628-6.929-15.28-11.195-4.637-4.267-8.835-9.075-12-14.532-6.651-10.727-8.868-24.241-5.64-37.07-2.572 6.072-3.835 12.814-3.517 19.579m267.31-67.768c-4.831 7.222-10.126 14.204-15.852 20.863-5.743 6.641-11.834 13.039-18.442 18.925 7.349-4.943 14.311-10.503 21-16.398 5.254-4.657 10.293-9.587 15.117-14.759 0.699 22.596 3.217 117.46-3.752 117.46 0 0-58.736 100.69-157.03 100.69-103.09 0-157.03-106.68-157.03-106.68-7.147 0-4.315-97.832-3.702-116.72 0.294 0.333 0.572 0.681 0.869 1.011 5.976 6.743 12.316 13.086 18.992 19.002 6.69 5.895 13.652 11.455 21 16.398-6.607-5.886-12.699-12.284-18.441-18.925-5.726-6.659-11.022-13.641-15.853-20.863-4.898-7.181-9.043-14.793-12.711-22.497l-2.588-5.84c-0.715-1.715-1.314-3.471-1.95-5.204v-153.62c1.819-2.992 10.128 6.929 11.987 3.995 1.894-2.988-2.662-18.828-0.726-21.753 2.262-3.416 7.994 5.903 10.315 2.575 1.805-2.588 0.186-17.842 2.028-20.376 27.532-37.88 59.221-69.634 96.263-93.498l51.543 26.371 54.741-26.371c44.253 21.563 76.05 56.112 101.13 97.667 1.411 2.339-2.609 13.825-1.24 16.207 1.442 2.506 8.27-4.092 9.666-1.541 1.156 2.109-3.6 12.588-2.473 14.726 1.248 2.368 8.375-3.6 9.589-1.198v168.39c-3.606 7.522-7.669 14.952-12.455 21.968"/>
  </g>
  <g transform="translate(280.53 443.27)">
  <path d="m0 0 0.051-0.022z" fill="#fff"/>
  </g>
  </g>
  <g clip-path="url(#d)">
  <g clip-path="url(#c)">
  <g clip-path="url(#b)">
  <path d="m535.08 55.65h0.416v-0.416h-0.416z" fill="url(#a)"/>
  </g>
  </g>
  </g>
  </g>
  </svg>`;

  //test nft description
  const nftDescription = "Long live Harambe!!!";

  const { config, error } = usePrepareContractWrite({
    address: contractAddress,
    abi: createSvgNftAbi,
    functionName: "mintNft",
    args: [svg, nftDescription],
    onSuccess(data) {
      console.log("Success", data.result);
    },
  });

  if (error) {
    console.log(error);
  }

  /* For some reason when we call the write method to read from the contract it costs gas, thus we can use useContractRead or just get the result from prepareContractWrite */
  const { data, write: mintNft } = useContractWrite(config);

  return (
    <>
      <Web3Button />
      <p>Create an NFT from an SVG</p>

      <div
        style={{
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          backgroundColor: "transparent",
          padding: "20px",
        }}
      >
        <FileInput onFileChange={handleFileChange} />
        <DisplaySVG svgFile={svgFile} />
      </div>
      <button
        className={styles["retro-button"]}
        disabled={!mintNft}
        onClick={() => mintNft?.()}
      >
        Mint
      </button>
    </>
  );
}
